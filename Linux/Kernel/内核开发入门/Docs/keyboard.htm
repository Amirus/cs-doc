<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=GB2312">
		<title>
			Bran的内核开发指南：键盘
		</title>
		<link href="layout.css" type="text/css" rel="stylesheet">
	</head>

	<body>
		<h2><font face="Tahoma">键盘</font></h2>

		<p><span style="font-family: Tahoma">
		键盘是用户对电脑进行输入的最常用工具，所以创建某类的驱动来处理和管理键盘很重要。当你开始考虑这个的时候，应该先获取一些键盘的要素，比如：当按下一个键的时候怎么样得到它，如何把所谓的“扫描码”转换成我们可以正确理解的标准</span><font face="Tahoma"><span lang="EN-US">ASCII
		</span></font><span style="font-family: Tahoma">字符。</span></p>
		<p><span style="font-family: Tahoma">
		扫描码仅仅是一个键号。键盘给键盘上的每个键分配一个号码，这就是扫描码。扫描码一般从左上到右下依次编号，同时有少量异常以与老式键盘向下兼容。你必须使用一个检查表（一个数组）并且把扫描码作为表的索引。检查表被称为
		键映射（</span><font face="Tahoma"><span lang="EN-US">keymap</span></font><span style="font-family: Tahoma">），并用来快速地把扫描码转换为</span><font face="Tahoma"><span lang="EN-US">ASCII</span></font><span style="font-family: Tahoma">码值。最后一点需要注意的是，如果第</span><font face="Tahoma"><span lang="EN-US">7</span></font><span style="font-family: Tahoma">位被设置（用“</span><font face="Tahoma"><span lang="EN-US">scancode 
		&amp; 0x80</span></font><span style="font-family: Tahoma">”语句测试），就说明一个键刚被释放。创建你的“</span><font face="Tahoma"><span lang="EN-US">kb.h</span></font><span style="font-family: Tahoma">”并完成所有标准程序，比如为</span><font face="Tahoma"><span lang="EN-US">GCC</span></font><span style="font-family: Tahoma">添加一行、添加一个文件到</span><font face="Tahoma"><span lang="EN-US">LD</span></font><span style="font-family: Tahoma">的命令行。</span></p>
		<table border="1" width="100%" id="table1" style="border-collapse: collapse">
			<tr>
				<td>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Courier New; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><font face="Tahoma"><span lang="EN-US">/* KBDUS</span></font><span style="font-family: Tahoma">表示</span><font face="Tahoma"><span lang="EN-US">US</span></font><span style="font-family: Tahoma">键盘布局。</span><font face="Tahoma"> </font><span style="font-family: Tahoma">这是对应于标准</span><font face="Tahoma"><span lang="EN-US">US</span></font><span style="font-family: Tahoma">键盘的扫描码表。</span></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Courier New; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><font face="Tahoma"><span lang="EN-US">*  </span></font><span style="font-family: Tahoma">我留下了一些注释以告诉你是哪个键，尽管我把数组索引设置为</span><font face="Tahoma"><span lang="EN-US">0</span></font><span style="font-family: Tahoma">。</span></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Courier New; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><font face="Tahoma"><span lang="EN-US">*  </span></font><span style="font-family: Tahoma">你也可以用一个宏来做你想要的修改。</span></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="EN-US">*/</span></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="EN-US">unsigned char kbdus[128] =</span></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="EN-US">{</span></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="EN-US">    0,  27, '1', '2', '3', '4', '5', '6', '7', '8',        /* 9 */</span></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Courier New; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><font face="Tahoma"><span lang="EN-US">  '9', '0', '-', '=', '\b',        /* </span></font><span style="font-family: Tahoma">退格</span><font face="Tahoma"><span lang="EN-US"> */</span></font></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Courier New; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><font face="Tahoma"><span lang="EN-US">  '\t',                    /* </span></font><span style="font-family: Tahoma">制表</span><font face="Tahoma"><span lang="EN-US"> */</span></font></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="EN-US">  'q', 'w', 'e', 'r',      /* 19 */</span></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Courier New; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><font face="Tahoma"><span lang="EN-US">  't', 'y', 'u', 'i', 'o', 'p', '[', ']', '\n',   /* </span></font><span style="font-family: Tahoma">回车</span><font face="Tahoma"><span lang="EN-US"> */</span></font></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="EN-US">    </span><span lang="IT">0,                      /* 29   - Control */</span></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="IT">  'a', 's', 'd', 'f', 'g', 'h', 'j', 'k', 'l', ';',       /* 39 */</span></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Courier New; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><font face="Tahoma"><span lang="IT"> </span><span lang="EN-US">'\'', '`',   0,            /* </span></font><span style="font-family: Tahoma">左边</span><font face="Tahoma"><span lang="EN-US">shift */</span></font></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="EN-US"> '\\', 'z', 'x', 'c', 'v', 'b', 'n',                     /* 49 */</span></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Courier New; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><font face="Tahoma"><span lang="EN-US">  'm', ',', '.', '/',   0,                         /* </span></font><span style="font-family: Tahoma">右边</span><font face="Tahoma"><span lang="EN-US">shift */</span></font></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="EN-US">  '*',</span></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="EN-US">    0,      /* Alt */</span></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Courier New; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><font face="Tahoma"><span lang="EN-US">  ' ',      /* </span></font><span style="font-family: Tahoma">空格</span><font face="Tahoma"><span lang="EN-US"> */</span></font></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Courier New; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><font face="Tahoma"><span lang="EN-US">    0,      /* </span></font><span style="font-family: Tahoma">大小写锁</span><font face="Tahoma"><span lang="EN-US"> */</span></font></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="EN-US">    0,      /* 59 - F1 key ... &gt; */</span></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="EN-US">    0,   0,   0,   0,   0,   0,  &nbsp;0,   0,</span></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="EN-US">    0,      /* &lt; ... F10 */</span></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="EN-US">    0,      /* 69 - Num lock*/</span></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="EN-US">    0,      /* Scroll Lock */</span></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="EN-US">    0,      /* Home key */</span></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Courier New; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><font face="Tahoma"><span lang="EN-US">    0,      /* </span></font><span style="font-family: Tahoma">向上键</span><font face="Tahoma"><span lang="EN-US"> */</span></font></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Courier New; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><font face="Tahoma"><span lang="EN-US">    0,      /* </span></font><span style="font-family: Tahoma">向上翻页</span><font face="Tahoma"><span lang="EN-US">*/</span></font></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="EN-US">  '-',</span></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Courier New; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><font face="Tahoma"><span lang="EN-US">    0,      /* </span></font><span style="font-family: Tahoma">向左键</span><font face="Tahoma"><span lang="EN-US">*/</span></font></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="EN-US">    0,</span></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Courier New; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><font face="Tahoma"><span lang="EN-US">    0,      /* </span></font><span style="font-family: Tahoma">向右键</span><font face="Tahoma"><span lang="EN-US">*/</span></font></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="EN-US">  '+',</span></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="EN-US">    0,      /* 79 - End key*/</span></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Courier New; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><font face="Tahoma"><span lang="EN-US">    0,      /* </span></font><span style="font-family: Tahoma">向下键</span><font face="Tahoma"><span lang="EN-US">*/</span></font></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Courier New; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><font face="Tahoma"><span lang="EN-US">    0,      /* </span></font><span style="font-family: Tahoma">向下翻页</span><font face="Tahoma"><span lang="EN-US">*/</span></font></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Courier New; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><font face="Tahoma"><span lang="EN-US">    0,      /* </span></font><span style="font-family: Tahoma">插入键</span><font face="Tahoma"><span lang="EN-US">*/</span></font></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Courier New; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><font face="Tahoma"><span lang="EN-US">    0,      /* </span></font><span style="font-family: Tahoma">删除键</span><font face="Tahoma"><span lang="EN-US">*/</span></font></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="EN-US">    0,   0,   0,</span></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="EN-US">    0,      /* F11 Key */</span></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="EN-US">    0,      /* F12 Key */</span></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Courier New; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><font face="Tahoma"><span lang="EN-US">    0,      /* </span></font><span style="font-family: Tahoma">所有未定义的键</span><font face="Tahoma"><span lang="EN-US"> */</span></font></font></pre>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="EN-US">};      </span></font></pre>
				</td>
			</tr>
			<tr>
				<td><b><span lang="EN-US"><font size="2" face="Tahoma">Keymap</font></span><font size="2"><span style="font-family: Tahoma">的例子。把这个数组添加到你的“</span><font face="Tahoma"><span lang="EN-US">kb.c</span></font></font><span style="font-family: Tahoma"><font size="2">”</font></span></b></td>
			</tr>
		</table>
<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 0cm; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><span lang="EN-US">&nbsp;</span></pre>
		<p><span style="font-family: Tahoma">把扫描码转换为</span><font face="Tahoma"><span lang="EN-US">ASCII</span></font><span style="font-family: Tahoma">值很简单：</span><font face="Tahoma"><span lang="EN-US">
</span></font></p>
		<table border="1" width="100%" id="table2" style="border-collapse: collapse">
			<tr>
				<td><font color="#800000" face="Tahoma"><span lang="EN-US">
				mychar = kbdus[scancode];</span></font></td>
			</tr>
		</table>
		<p><span style="font-family: Tahoma">注意到尽管我们为功能键和</span><font face="Tahoma"><span lang="EN-US">ALT/CONTROL/SHIFT</span></font><span style="font-family: Tahoma">留下了注释，但是在数组中他们都是“</span><font face="Tahoma"><span lang="EN-US">0</span></font><span style="font-family: Tahoma">”：你需要想一些值（比如平时不会用到的</span><font face="Tahoma"><span lang="EN-US">ASCII</span></font><span style="font-family: Tahoma">值），从而可以捕抓到它们。我把这个任务留给你，但你不应该用一个全局变量作为键的状态变量。这个键状态变量将有三位分别留给</span><font face="Tahoma"><span lang="EN-US">ALT</span></font><span style="font-family: Tahoma">、</span><font face="Tahoma"><span lang="EN-US">CONTROL</span></font><span style="font-family: Tahoma">和</span><font face="Tahoma"><span lang="EN-US">SHIFT</span></font><span style="font-family: Tahoma">。为</span><font face="Tahoma"><span lang="EN-US">CAPS 
		LOCK </span></font><span style="font-family: Tahoma">、</span><font face="Tahoma"><span lang="EN-US">NUM 
		LOCK </span></font><span style="font-family: Tahoma">和</span><font face="Tahoma"><span lang="EN-US">SCROLL 
		LOCK</span></font><span style="font-family: Tahoma">各保留一位也是不错的主意。本指南将解释如何设置键盘灯，但实际代码的书写工作将留给你。</span></p>
		<p><span style="font-family: Tahoma">
		键盘通过主板上一个特别的微控制芯片与计算机相连。键盘控制芯片有两个通道：一个用于键盘，一个用于鼠标。同样注意到，通过键盘控制芯片，你可以使能处理器的</span><font face="Tahoma"><span lang="EN-US">A20</span></font><span style="font-family: Tahoma">地址线，从而可以越过</span><font face="Tahoma"><span lang="EN-US">1MB</span></font><span style="font-family: Tahoma">标记访问内存（</span><font face="Tahoma"><span lang="EN-US">GRUB</span></font><span style="font-family: Tahoma">使能了这个，所以你不比再为此担心）。键盘控制器作为一个系统可访问的设备，在</span><font face="Tahoma"><span lang="EN-US">I/O</span></font><span style="font-family: Tahoma">总线上有一个地址，我们可以用这个地址对其进行访问和控制。键盘有两个主要的寄存器：一个在</span><font face="Tahoma"><span lang="EN-US">0x60</span></font><span style="font-family: Tahoma">的数据寄存器和一个在</span><font face="Tahoma"><span lang="EN-US">0x64</span></font><span style="font-family: Tahoma">的控制寄存器。任何键盘想送给计算机的东西都存储在数据寄存器。键盘在有数据可读时将激活</span><font face="Tahoma"><span lang="EN-US">IRQ1</span></font><span style="font-family: Tahoma">。看看下面的程序：</span></p>
		<table border="1" width="100%" id="table3" style="border-collapse: collapse">
			<tr>
				<td>
		<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Courier New; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><font face="Tahoma"><span lang="EN-US">/* </span></font><span style="font-family: Tahoma">处理键盘中断</span><font face="Tahoma"><span lang="EN-US"> */</span></font></font></pre>
		<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="EN-US">void keyboard_handler(struct regs *r)</span></font></pre>
		<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="EN-US">{</span></font></pre>
		<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="EN-US">    unsigned char scancode;</span></font></pre>
		<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="EN-US">&nbsp;</span></font></pre>
		<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Courier New; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><font face="Tahoma"><span lang="EN-US">    /* </span></font><span style="font-family: Tahoma">从键盘的数据缓冲中读</span><font face="Tahoma"><span lang="EN-US"> */</span></font></font></pre>
		<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="EN-US">    scancode = inportb(0x60);</span></font></pre>
		<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="EN-US">&nbsp;</span></font></pre>
		<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Courier New; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><font face="Tahoma"><span lang="EN-US">    /* </span></font><span style="font-family: Tahoma">如果我们从键盘读入的字节的顶位被设置了，就意味着一个键刚被释放。</span><font face="Tahoma"><span lang="EN-US"> */</span></font></font></pre>
		<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="EN-US">    if (scancode &amp; 0x80)</span></font></pre>
		<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="EN-US">    {</span></font></pre>
		<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Courier New; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><font face="Tahoma"><span lang="EN-US">        /* </span></font><span style="font-family: Tahoma">你可以用这个来测试用户是否释放了</span><font face="Tahoma"><span lang="EN-US">ALT</span></font><span style="font-family: Tahoma">、</span><font face="Tahoma"><span lang="EN-US">SHIFT</span></font><span style="font-family: Tahoma">、</span><font face="Tahoma"><span lang="EN-US">CONTROL</span></font><span style="font-family: Tahoma">……等键。</span><font face="Tahoma"><span lang="EN-US"> */</span></font></font></pre>
		<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="EN-US">    }</span></font></pre>
		<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="EN-US">    else</span></font></pre>
		<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="EN-US">    {</span></font></pre>
		<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Courier New; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><font face="Tahoma"><span lang="EN-US">        /* </span></font><span style="font-family: Tahoma">这里，一个键被按下。请注意如果你按住一个键，你就将重复地产生按键中断。</span><font face="Tahoma"><span lang="EN-US"> */</span></font></font></pre>
		<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="EN-US">&nbsp;</span></font></pre>
		<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Courier New; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><font face="Tahoma"><span lang="EN-US">        /* </span></font><span style="font-family: Tahoma">为了说明这是如何工作的，我们简单地把键盘扫描码转换成</span><font face="Tahoma"><span lang="EN-US">ASCII</span></font><span style="font-family: Tahoma">值，</span></font></pre>
		<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Courier New; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><font face="Tahoma"><span lang="EN-US">        *  </span></font><span style="font-family: Tahoma">然后把它显示到屏幕。你可能想用别的做法，比如用一些标志来测试</span></font></pre>
		<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Courier New; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><font face="Tahoma"><span lang="EN-US">        *  SHIFT</span></font><span style="font-family: Tahoma">是否被按下，用一个不同的布局，或者添加另外的</span><font face="Tahoma"><span lang="EN-US">128</span></font><span style="font-family: Tahoma">个入口</span></font></pre>
		<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Courier New; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><font face="Tahoma"><span lang="EN-US">        *  </span></font><span style="font-family: Tahoma">到上面的布局来对应</span><font face="Tahoma"><span lang="EN-US">SHIFT</span></font><span style="font-family: Tahoma">被按住的情况。如果使用更大的检查表对应</span></font></pre>
		<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Courier New; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><font face="Tahoma"><span lang="EN-US">        *  SHIFT</span></font><span style="font-family: Tahoma">被按下的情况，查找时你需要在扫描码上加上</span><font face="Tahoma"><span lang="EN-US">128</span></font><span style="font-family: Tahoma">。</span></font></pre>
		<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="EN-US">     */</span></font></pre>
		<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="EN-US">        putch(kbdus[scancode]);</span></font></pre>
		<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="EN-US">    }</span></font></pre>
		<pre style="tab-stops: 45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; font-size: 10.0pt; font-family: Tahoma; margin-left: 24.0pt; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt"><font color="#800000"><span lang="EN-US">}</span></font></pre>
				</td>
			</tr>
			<tr>
				<td><b><span style="font-family: Tahoma">
				<font size="2">看起来很复杂，但</font></span><font size="2"><font face="Tahoma"><span lang="EN-US">80</span></font><span style="font-family: Tahoma">％都是注释<span lang="en-us">。</span>把它添加到“</span><font face="Tahoma"><span lang="EN-US">kb.c</span></font></font><span style="font-family: Tahoma"><font size="2">”</font></span></b></td>
			</tr>
		</table>
		<p><span style="font-family: Tahoma">就像你看到的一样，键盘将会产生一个</span><font face="Tahoma"><span lang="EN-US">IRQ1</span></font><span style="font-family: Tahoma">来告诉我们它有数据就绪可读。键盘的数据寄存器在</span><font face="Tahoma"><span lang="EN-US">0x60</span></font><span style="font-family: Tahoma">。当</span><font face="Tahoma"><span lang="EN-US">IRQ</span></font><span style="font-family: Tahoma">发生时，我们调用处理程序从</span><font face="Tahoma"><span lang="EN-US">0x60</span></font><span style="font-family: Tahoma">端口读。我们读到的数据时键盘的扫描码。在本例中，我们测试键是被按下还是被释放。如果只是按下，我们把扫描码转换成</span><font face="Tahoma"><span lang="EN-US">ASCII</span></font><span style="font-family: Tahoma">，并用一行把那个字符打印处理。编写“</span><font face="Tahoma"><span lang="EN-US">keyboard_install</span></font><span style="font-family: Tahoma">”函数，调用“</span><font face="Tahoma"><span lang="EN-US">irq_install_handler</span></font><span style="font-family: Tahoma">”安装定制的键盘处理程序――“</span><font face="Tahoma"><span lang="EN-US">keyboard_handler
		</span></font><span style="font-family: Tahoma">”到</span><font face="Tahoma"><span lang="EN-US">IRQ1</span></font><span style="font-family: Tahoma">。确保在“</span><font face="Tahoma"><span lang="EN-US">main</span></font><span style="font-family: Tahoma">”中对“</span><font face="Tahoma"><span lang="EN-US">keyboard_install
		</span></font><span style="font-family: Tahoma">”进行调用。</span></p>
		<p><span style="font-family: Tahoma">
		为了设置键盘灯，你需要给键盘控制器发送一个指令。给键盘发送命令有特殊的程序。首先你必须等待键盘控制器，直到它的状态为空闲。为了做到这一点，你需要循环地从控制寄存器中读（这时，它被称为状态寄存器），直到键盘空闲：</span></p>
		<table border="1" width="100%" id="table4" style="border-collapse: collapse">
			<tr>
				<td><font face="Tahoma" size="2"><span lang="EN-US"><font color="#800000">
				if ((inportb(0x64) &amp; 2) == 0) break;</font> </span></font></td>
			</tr>
		</table>
		<p><span style="font-family: Tahoma">
		循环之后，你可以把控制字节写入数据寄存器。除了特殊情况，你不应该直接写入控制寄存器。要设置键盘灯，你先要按上面说的办法发送控制字节</span><font face="Tahoma"><span lang="EN-US">0xED
		</span></font><span style="font-family: Tahoma">
		，然后发送字节说明哪个灯要开或关。这个字节有下面的格式：</span><font face="Tahoma"><span lang="EN-US">Bit0</span></font><span style="font-family: Tahoma">是</span><font face="Tahoma"><span lang="EN-US">Scroll 
		lock</span></font><span style="font-family: Tahoma">，</span><font face="Tahoma"><span lang="EN-US">Bit1</span></font><span style="font-family: Tahoma">是</span><font face="Tahoma"><span lang="EN-US">Num 
		lock</span></font><span style="font-family: Tahoma">，而</span><font face="Tahoma"><span lang="EN-US">Bit2</span></font><span style="font-family: Tahoma">是</span><font face="Tahoma"><span lang="EN-US">Caps 
		lock</span></font><span style="font-family: Tahoma">。</span></p>
		<span style="font-size: 12.0pt; font-family: Tahoma">
		既然有了基本的键盘支持，你可能还希望扩展上面的代码。关于键盘的这一节更多的是像你展示如何进行基本操作，而不是非常详细地总览所有的键盘控制函数。注意到你要用键盘控制器去使能和处理</span><span lang="EN-US" style="font-size: 12.0pt; font-family: Tahoma">PS/2</span><span style="font-size: 12.0pt; font-family: Tahoma">鼠标端口。键盘控制器的辅助通道管理着</span><span lang="EN-US" style="font-size: 12.0pt; font-family: Tahoma">PS/2</span><span style="font-size: 12.0pt; font-family: Tahoma">鼠标。到这个时候，我们有了一个可以在屏幕绘图、处理异常、</span><span lang="EN-US" style="font-size: 12.0pt; font-family: Tahoma">IRQ</span><span style="font-size: 12.0pt; font-family: Tahoma">、计时器和键盘的内核了。点击查看还剩下什么是你的内核需要开发的。<br>
		</span><font face="Tahoma">&nbsp;</font><table cols="150, *, 150" width="100%">
			<tr>
				<td align="left" width="150">
					<font face="Tahoma">
					<a href="pit.htm">&lt;&lt; 可编程间隔定时器</a>
					</font>
				</td>
				<td align="center" width="*">
					<font face="Tahoma">
					<a href="mailto:friesenb@gmail.com">联系 Brandon F.</a>
					</font>
				</td>
				<td align="right" width="150">
					<a href="whatsleft.htm"><font face="Tahoma">后面该做什么？&gt;&gt;</font></a>
					</font>
				</td>
			</tr>
		</table>
	</body>
</html>