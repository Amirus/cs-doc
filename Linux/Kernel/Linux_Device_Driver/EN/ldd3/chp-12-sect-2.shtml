<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>12.2. A Look Back: ISA</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body >
<head>
<link rel="stylesheet" type="text/css" href="../style/visited-green.css">
</head>
<div align=center>
<script type="text/javascript" src="http://j.maxmind.com/app/geoip.js"></script>
<center>
<table width=100% height=90>
<tr style='display:none'>
<td style='display:xnone' id='banner' xalign=center style="background-image:url(/kernel_map.d/LKM3_2048.png);width:100%;height:90;opacity:0;filter:alpha(opacity=0);
cursor:pointer" onclick="top.location='http://www.makelinux.com/kernel_map?b'" /> 
</td> </tr>
<tr style='display:none'>
<td  id='banner2' style="opacity:0;filter:alpha(opacity=0);text-align:center;" /> 
<a target=_top href=http://www.makelinux.com/kernel_map_poster?b>
<span style="font-weight:bold"><span style="display:block;font-size:large" >Poster of Linux kernel</span>The best gift for a Linux geek</span>
</a>
</td> </tr>
<tr style='zdisplay:xnone' >
<td  id='banner3' align=center /> 
<a Xtarget=_top href="http://www.makelinux.com/kernel_map_poster?b"> <img target=_top src="http://www.makelinux.net/kernel_map.d/poster2.png" border=0></a>
</td></tr>
</table>
</center>
<script type='text/javascript' src='../common/fade.js'></script>
<script type=text/javascript>

	var banner = document.getElementById('banner');
	banner.style.backgroundPosition="50% 50%";
	banner.style.backgroundPosition=100*Math.random()+"% "+100*Math.random(100)+"%";
	//fade('banner');
    	//setTimeout("fade('banner')",1000);
    	//setTimeout("fade('banner2')",1000);
</script>

<script type="text/javascript">
var a = new Array();
a[0]='<a href=http://www.linuxdriver.co.il/>www.LinuxDriver.co.il - Embedded Linux solutions: Drivers, Media Streaming, Fast Boot. In Tel-Aviv</a>';
a[1]='<a href=http://www.MakeLinux.net/>www.MakeLinux.net - Embedded Linux solutions: Drivers, Media Streaming, Fast Boot</a>';
a[2]='<a href="http://www.amazon.com/gp/product/0672329468?ie=UTF8&tag=makelinux-20&linkCode=as2&camp=1789&creative=390957&creativeASIN=0672329468">New book <b>Linux Kernel Development</b> (3rd Edition) 2010</a><img src="http://www.assoc-amazon.com/e/ir?t=makelinux-20&l=as2&o=1&a=0672329468" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />';
a[3]='';
google_ad_width = 728;
google_ad_height = 1;
if ( 0) { 
document.write("<center>");
if (  geoip_country_code()=="IL" ) {
	if ( Math.random() > 0.5 ) document.write(a[0]+"<br>"); else document.write(a[2]);;
	google_ad_width = 728;
	google_ad_height = 1;
} else { 
	if ( Math.random() > 0.5 ) {
		if ( Math.random() > 0.5 ) document.write(a[1]+"<br>"); else document.write(a[2]);
		google_ad_width = 728;
		google_ad_height = 1;
	} else {
		google_ad_client = "pub-5656623102424572";
		/* 728x90, created 4/4/08 */
		google_ad_slot = "6613964975";
		google_ad_width = 728;
		google_ad_height = 100;
	}
}
	document.write("</center>");
}
</script>
<!--
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js"> </script>
-->


</div>
<!-- 
Hi surfer
<script type="text/javascript"> 
	try {
	document.write(" from <i><b>" + geoip_city()+"</b></i>"); 
	} catch (e) {
	}
</script>, please visit -->


<xhr>
<script type="text/javascript">
	s = document.location.href.lastIndexOf("/");
	a = document.location.href.substring(0,s+1);
	b = document.location.href.substring(s+1);
if ( document.location == top.location  ) {
	//alert(a + " -- " + b);
	document.write("<a href="http://www.makelinux.net/ldd3/+&#32;a&#32;+"?u=" +b + "> &lt; open Table of Content</a>");
	//top.location = a + "?u=" +b;
} else {
	document.write("<a target=_top href="http://www.makelinux.net/ldd3/+document.location&#32;+"> &lt; full page </a>");
}
function addLoadEvent(func) 
{
	var oldonload = window.onload;
	if (typeof window.onload != 'function') {
		window.onload = func;
	} else {
		window.onload = function() {
			oldonload();
			func();
		}
	}
}

addLoadEvent(  function() { 
		try {
		} catch (e) {
	}
}
);


</script>
<span style='display:none;background:#BBFFFF;color:black;position:absolute;right:0;' ><a target=_main href=http://www.makelinux.net/kernel_map?src=ldd3>&nbsp;Linux kernel map&nbsp;</a></span><br>
<script type="text/javascript">
</script>
<script src="http://www.google-analytics.com/urchin.js" type="text/javascript"> </script>
<script type="text/javascript"> _uacct = "UA-839593-1"; if (typeof(urchinTracker) == 'function') urchinTracker();</script>
<script type=text/javascript>
	// document.write("<img src=http://const.homelinux.net/1.png?REF="+top.document.referrer+" height=0 width=0 border=0 />");
</script>


<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr >
<td class="v2" align="left" width="30%">
<a href="chp-12-sect-1.shtml"> &#8678; prev </a>
</td>
<td class="v2" align="center" width="40%">
<a href="index.html" target=_parent style="text-decoration:none;text-underline:none"> &#8689; home </a>
</td>
<td class="v2" align="right" width="30%">
<a href="chp-12-sect-3.shtml"> next &#8680; </a>
</td>
</tr>
</table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><TR><TD valign="top"><a name="chp-12-sect-2"></a>
<h3 class="docSection1Title">12.2. A Look Back: ISA</h3>

<p class="docText">The ISA bus is quite old in <a name="chp-12-ITERM-6356"></a>
<a name="chp-12-ITERM-6357"></a>
<a name="chp-12-ITERM-6358"></a>design and is a notoriously poor
performer, but it still holds a good part of the market for extension
devices. If speed is not important and you want to support old
motherboards, an ISA implementation is preferable to PCI. An
additional advantage of this old standard is that if you are an
electronic hobbyist, you can easily build your own ISA devices,
something definitely not possible with PCI.</p>

<p class="docText">On the other hand, a great disadvantage of ISA is that
it's tightly bound to the PC architecture; the
interface bus has all the limitations of the 80286 processor and
causes endless pain to system programmers. The other great problem
with the ISA design (inherited from the original IBM PC) is the lack
of geographical addressing, which has led to many problems and
lengthy unplug-rejumper-plug-test cycles to add new devices.
It's interesting to note that even the oldest Apple
II computers were already exploiting geographical addressing, and
they featured jumperless expansion boards.</p>

<p class="docText">Despite its great disadvantages, ISA is still used in several
unexpected places. For example, the VR41xx series of MIPS processors
used in several palmtops features an ISA-compatible expansion bus,
strange as it seems. The reason behind these unexpected uses of ISA
is the extreme low cost of some legacy hardware, such as 8390-based
Ethernet cards, so a CPU with ISA electrical signaling can easily
exploit the awful, but cheap, PC devices.</P>

<a name="chp-12-sect-2.1"></a>
<H4 class="docSection2Title">12.2.1. Hardware Resources</H4>

<p class="docText">An ISA device can be equipped with I/O
<a name="chp-12-ITERM-6359"></a>
<a name="chp-12-ITERM-6360"></a>ports,
memory areas, and interrupt lines.</p>

<p class="docText">Even though the x86 processors support 64 KB of I/O port memory
(i.e., the processor asserts 16 address lines), some old PC hardware
decodes only the lowest 10 address lines. This limits the usable
address space to 1024 ports, because any address in the range 1 KB to
64 KB is mistaken for a low address by any device that decodes only
the low address lines. Some peripherals circumvent this limitation by
mapping only one port into the low kilobyte and using the high
address lines to select between different device registers. For
example, a device mapped at <tt>0x340</tt> can safely use
port <tt>0x740</tt>, <tt>0xB40</tt>, and so on.</P>

<p class="docText">If the availability of I/O ports is limited, memory access is still
worse. An ISA device can use only the memory range between 640 KB and
1 MB and between 15 MB and 16 MB for I/O register and device control.
The 640-KB to 1-MB range is used by the PC BIOS, by VGA-compatible
video boards, and by various other devices, leaving little space
available for new devices. Memory at 15 MB, on the other hand, is not
directly supported by Linux, and hacking the kernel to support it is
a waste of programming time nowadays.</P>

<p class="docText">The third resource available to ISA device boards is interrupt lines.
A limited number of interrupt lines is routed to the ISA bus, and
they are shared by all the interface boards. As a result, if devices
aren't properly configured, they can find themselves
using the same interrupt lines.</p>

<p class="docText">Although the original ISA specification doesn't
allow interrupt sharing across devices, most device boards allow
it.<sup class="docFootnote"><a class="docLink" href="chp-12-sect-2.shtml#chp-12-FNOTE-5">[5]</a></sup> Interrupt sharing at the software level
is described in <a class="docLink" href="chp-10.shtml#chp-10">Chapter 10</a>.</p><blockquote><p class="docFootnote"><sup><a name="chp-12-FNOTE-5">[5]</a></sup> The problem with interrupt sharing is a matter of
electrical engineering: if a device drives the signal line
inactive—by applying a low-impedance voltage level—the
interrupt can't be shared. If, on the other hand,
the device uses a pull-up resistor to the inactive logic level,
sharing is possible. This is the norm nowadays. However,
there's still a potential risk of losing interrupt
events since ISA interrupts are edge triggered instead of level
triggered. Edge-triggered interrupts are easier to implement in
hardware but don't lend themselves to safe
sharing.</p></blockquote>


<a name="chp-12-sect-2.2"></a>
<h4 class="docSection2Title">12.2.2. ISA Programming</H4>

<p class="docText">As far as programming
is<a name="chp-12-ITERM-6361"></a>
<a name="chp-12-ITERM-6362"></a>
concerned, there's no specific aid in the kernel or
the BIOS to ease access to ISA devices (like there is, for example,
for PCI). The only facilities you can use are the registries of I/O
ports and IRQ lines, described in 
<a class="docLink" href="chp-10-sect-2.shtml#chp-10-sect-2">Section 10.2</a>.</p>

<p class="docText">The programming techniques shown throughout the first part of this
book apply to ISA devices; the driver can probe for I/O ports, and
the interrupt line must be autodetected with one of the techniques
shown in <a class="docLink" href="chp-10-sect-2.shtml#chp-10-sect-2.2">Section 10.2.2</a>.</p>

<p class="docText">The helper functions <span class="docEmphasis">isa_readb</span> and friends have
been briefly introduced in 
<a class="docLink" href="chp-9.shtml#chp-9">Chapter 9</a>, and
there's nothing more to say about them.</P>


<a name="chp-12-sect-2.3"></a>
<h4 class="docSection2Title">12.2.3. The Plug-and-Play Specification</h4>

<p class="docText">Some new ISA device boards follow peculiar design rules and require a
special initialization sequence intended to simplify installation and
configuration of add-on interface boards. The specification for the
design of these boards is called <span class="docEmphasis">plug and
play</span><a name="chp-12-ITERM-6363"></a> <a name="chp-12-ITERM-6364"></a> (PnP) and consists of a cumbersome rule
set for building and configuring jumperless ISA devices. PnP devices
implement relocatable I/O regions; the PC's BIOS is
responsible for the relocation—reminiscent of PCI.</P>

<p class="docText">In short, the goal of PnP is to obtain the same flexibility found in
PCI devices without changing the underlying electrical interface (the
ISA bus). To this end, the specs define a set of device-independent
configuration registers and a way to geographically address the
interface boards, even though the physical bus
doesn't carry per-board (geographical)
wiring—every ISA signal line connects to every available slot.</p>

<p class="docText">Geographical addressing works by assigning a small integer, called
the <span class="docEmphasis">card select number</span><a name="chp-12-ITERM-6365"></a> <a name="chp-12-ITERM-6366"></a> (CSN), to each PnP
peripheral in the computer. Each PnP device features a unique serial
identifier, 64 bits wide, that is hardwired into the peripheral
board. CSN assignment uses the unique serial number to identify the
PnP devices. But the CSNs can be assigned safely only at boot time,
which requires the BIOS to be PnP aware. For this reason, old
computers require the user to obtain and insert a specific
configuration diskette, even if the device is PnP capable.</P>

<p class="docText">Interface boards following the PnP specs are complicated at the
hardware level. They are much more elaborate than PCI boards and
require complex software. It's not unusual to have
difficulty installing these devices, and even if the installation
goes well, you still face the performance constraints and the limited
I/O space of the ISA bus. It's much better to
install PCI devices whenever possible and enjoy the new technology
instead.</p>

<p class="docText">If you are interested in the PnP configuration software, you can
browse <i>drivers/net/3c509.c</i>, whose probing
function deals with PnP devices. The 2.6 kernel saw a lot of work in
the PnP device support area, so a lot of the inflexible interfaces
have been cleaned up compared to<a name="chp-12-ITERM-6367"></a> <a name="chp-12-ITERM-6368"></a> <a name="chp-12-ITERM-6369"></a> previous kernel releases.</p>



<ul></ul></td></tr></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr >
<td class="v2" align="left" width="30%">
<a href="chp-12-sect-1.shtml"> &#8678; prev </a>
</td>
<td class="v2" align="center" width="40%">
<a href="index.html" target=_parent style="text-decoration:none;text-underline:none"> &#8689; home </a>
</td>
<td class="v2" align="right" width="30%">
<a href="chp-12-sect-3.shtml"> next &#8680; </a>
</td>
</tr>
</table>
<script type="text/javascript" src="http://j.maxmind.com/app/geoip.js"></script>
<center>
<table width=100% height=90>
<tr style='display:none'>
<td style='display:xnone' id='banner' xalign=center style="background-image:url(/kernel_map.d/LKM3_2048.png);width:100%;height:90;opacity:0;filter:alpha(opacity=0);
cursor:pointer" onclick="top.location='http://www.makelinux.com/kernel_map?b'" /> 
</td> </tr>
<tr style='display:none'>
<td  id='banner2' style="opacity:0;filter:alpha(opacity=0);text-align:center;" /> 
<a target=_top href=http://www.makelinux.com/kernel_map_poster?b>
<span style="font-weight:bold"><span style="display:block;font-size:large" >Poster of Linux kernel</span>The best gift for a Linux geek</span>
</a>
</td> </tr>
<tr style='zdisplay:xnone' >
<td  id='banner3' align=center /> 
<a Xtarget=_top href="http://www.makelinux.com/kernel_map_poster?b"> <img target=_top src="http://www.makelinux.net/kernel_map.d/poster2.png" border=0></a>
</td></tr>
</table>
</center>
<script type='text/javascript' src='../common/fade.js'></script>
<script type=text/javascript>

	var banner = document.getElementById('banner');
	banner.style.backgroundPosition="50% 50%";
	banner.style.backgroundPosition=100*Math.random()+"% "+100*Math.random(100)+"%";
	//fade('banner');
    	//setTimeout("fade('banner')",1000);
    	//setTimeout("fade('banner2')",1000);
</script>

<script type="text/javascript">
var a = new Array();
a[0]='<a href=http://www.linuxdriver.co.il/>www.LinuxDriver.co.il - Embedded Linux solutions: Drivers, Media Streaming, Fast Boot. In Tel-Aviv</a>';
a[1]='<a href=http://www.MakeLinux.net/>www.MakeLinux.net - Embedded Linux solutions: Drivers, Media Streaming, Fast Boot</a>';
a[2]='<a href="http://www.amazon.com/gp/product/0672329468?ie=UTF8&tag=makelinux-20&linkCode=as2&camp=1789&creative=390957&creativeASIN=0672329468">New book <b>Linux Kernel Development</b> (3rd Edition) 2010</a><img src="http://www.assoc-amazon.com/e/ir?t=makelinux-20&l=as2&o=1&a=0672329468" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />';
a[3]='';
google_ad_width = 728;
google_ad_height = 1;
if ( 0) { 
document.write("<center>");
if (  geoip_country_code()=="IL" ) {
	if ( Math.random() > 0.5 ) document.write(a[0]+"<br>"); else document.write(a[2]);;
	google_ad_width = 728;
	google_ad_height = 1;
} else { 
	if ( Math.random() > 0.5 ) {
		if ( Math.random() > 0.5 ) document.write(a[1]+"<br>"); else document.write(a[2]);
		google_ad_width = 728;
		google_ad_height = 1;
	} else {
		google_ad_client = "pub-5656623102424572";
		/* 728x90, created 4/4/08 */
		google_ad_slot = "6613964975";
		google_ad_width = 728;
		google_ad_height = 100;
	}
}
	document.write("</center>");
}
</script>
<!--
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js"> </script>
-->



<script type="text/javascript" src="http://j.maxmind.com/app/geoip.js"></script>
<script type="text/javascript" >
{
	var os, br, ua = navigator.userAgent;

	if (ua.indexOf("Linux")!=-1) os="Linux";
	if (ua.indexOf("Windows")!=-1) os="Windows";
	if (ua.indexOf("Mac")!=-1) os="Mac";

	if (ua.indexOf("Gecko")!=-1) br="Gecko";
	if (ua.indexOf("Firefox")!=-1) br="Firefox";
	if (ua.indexOf("WebKit")!=-1) br="WebKit";
	if (ua.indexOf("MSIE")!=-1) br="MSIE";
	if (ua.indexOf("Safari")!=-1) br="Safari";
	if (ua.indexOf("Chrome")!=-1) br="Chrome";
	if (ua.indexOf("Konqueror")!=-1) br="Konqueror";
	if (ua.indexOf("Opera")!=-1) br="Opera";

	function query_var(query, variable) 
	{
		var vars = query.replace(/\?/g,"&").replace(/%20/g,"+").split("&");
		for (var i=0;i<vars.length;i++) {
			var pair = vars[i].split("=");
			if (pair[0] == variable) {
				return pair[1];
			}

		} 
	}
	var RQ="";
	q = query_var(top.document.referrer,'q');
	if ( q != undefined)
		RQ = ".&Q=" + q
	else if (top.document.referrer.length)
	
		RQ = ".&R=" + top.document.referrer;
	var traceimg= new Image();
	try {
		traceimg.src="http://const.homelinux.net/1.png?U="
			+ br + "-" + os 
			+"."+geoip_region_name().replace(/ /g,"_") 
			+"."+geoip_country_code()
			+ RQ ;
	} catch (e) {
	}
}
</script>


</body>
</html>
