<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>2.8. Module Parameters</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body >
<head>
<link rel="stylesheet" type="text/css" href="../style/visited-green.css">
</head>
<div align=center>
<script type="text/javascript" src="http://j.maxmind.com/app/geoip.js"></script>
<center>
<table width=100% height=90>
<tr style='display:none'>
<td style='display:xnone' id='banner' xalign=center style="background-image:url(/kernel_map.d/LKM3_2048.png);width:100%;height:90;opacity:0;filter:alpha(opacity=0);
cursor:pointer" onclick="top.location='http://www.makelinux.com/kernel_map?b'" /> 
</td> </tr>
<tr style='display:none'>
<td  id='banner2' style="opacity:0;filter:alpha(opacity=0);text-align:center;" /> 
<a target=_top href=http://www.makelinux.com/kernel_map_poster?b>
<span style="font-weight:bold"><span style="display:block;font-size:large" >Poster of Linux kernel</span>The best gift for a Linux geek</span>
</a>
</td> </tr>
<tr style='zdisplay:xnone' >
<td  id='banner3' align=center /> 
<a Xtarget=_top href="http://www.makelinux.com/kernel_map_poster?b"> <img target=_top src="http://www.makelinux.net/kernel_map.d/poster2.png" border=0></a>
</td></tr>
</table>
</center>
<script type='text/javascript' src='../common/fade.js'></script>
<script type=text/javascript>

	var banner = document.getElementById('banner');
	banner.style.backgroundPosition="50% 50%";
	banner.style.backgroundPosition=100*Math.random()+"% "+100*Math.random(100)+"%";
	//fade('banner');
    	//setTimeout("fade('banner')",1000);
    	//setTimeout("fade('banner2')",1000);
</script>

<script type="text/javascript">
var a = new Array();
a[0]='<a href=http://www.linuxdriver.co.il/>www.LinuxDriver.co.il - Embedded Linux solutions: Drivers, Media Streaming, Fast Boot. In Tel-Aviv</a>';
a[1]='<a href=http://www.MakeLinux.net/>www.MakeLinux.net - Embedded Linux solutions: Drivers, Media Streaming, Fast Boot</a>';
a[2]='<a href="http://www.amazon.com/gp/product/0672329468?ie=UTF8&tag=makelinux-20&linkCode=as2&camp=1789&creative=390957&creativeASIN=0672329468">New book <b>Linux Kernel Development</b> (3rd Edition) 2010</a><img src="http://www.assoc-amazon.com/e/ir?t=makelinux-20&l=as2&o=1&a=0672329468" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />';
a[3]='';
google_ad_width = 728;
google_ad_height = 1;
if ( 0) { 
document.write("<center>");
if (  geoip_country_code()=="IL" ) {
	if ( Math.random() > 0.5 ) document.write(a[0]+"<br>"); else document.write(a[2]);;
	google_ad_width = 728;
	google_ad_height = 1;
} else { 
	if ( Math.random() > 0.5 ) {
		if ( Math.random() > 0.5 ) document.write(a[1]+"<br>"); else document.write(a[2]);
		google_ad_width = 728;
		google_ad_height = 1;
	} else {
		google_ad_client = "pub-5656623102424572";
		/* 728x90, created 4/4/08 */
		google_ad_slot = "6613964975";
		google_ad_width = 728;
		google_ad_height = 100;
	}
}
	document.write("</center>");
}
</script>
<!--
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js"> </script>
-->


</div>
<!-- 
Hi surfer
<script type="text/javascript"> 
	try {
	document.write(" from <i><b>" + geoip_city()+"</b></i>"); 
	} catch (e) {
	}
</script>, please visit -->


<xhr>
<script type="text/javascript">
	s = document.location.href.lastIndexOf("/");
	a = document.location.href.substring(0,s+1);
	b = document.location.href.substring(s+1);
if ( document.location == top.location  ) {
	//alert(a + " -- " + b);
	document.write("<a href="http://www.makelinux.net/ldd3/+&#32;a&#32;+"?u=" +b + "> &lt; open Table of Content</a>");
	//top.location = a + "?u=" +b;
} else {
	document.write("<a target=_top href="http://www.makelinux.net/ldd3/+document.location&#32;+"> &lt; full page </a>");
}
function addLoadEvent(func) 
{
	var oldonload = window.onload;
	if (typeof window.onload != 'function') {
		window.onload = func;
	} else {
		window.onload = function() {
			oldonload();
			func();
		}
	}
}

addLoadEvent(  function() { 
		try {
		} catch (e) {
	}
}
);


</script>
<span style='display:none;background:#BBFFFF;color:black;position:absolute;right:0;' ><a target=_main href=http://www.makelinux.net/kernel_map?src=ldd3>&nbsp;Linux kernel map&nbsp;</a></span><br>
<script type="text/javascript">
</script>
<script src="http://www.google-analytics.com/urchin.js" type="text/javascript"> </script>
<script type="text/javascript"> _uacct = "UA-839593-1"; if (typeof(urchinTracker) == 'function') urchinTracker();</script>
<script type=text/javascript>
	// document.write("<img src=http://const.homelinux.net/1.png?REF="+top.document.referrer+" height=0 width=0 border=0 />");
</script>


<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr >
<td class="v2" align="left" width="30%">
<a href="chp-2-sect-7.shtml"> &#8678; prev </a>
</td>
<td class="v2" align="center" width="40%">
<a href="index.html" target=_parent style="text-decoration:none;text-underline:none"> &#8689; home </a>
</td>
<td class="v2" align="right" width="30%">
<a href="chp-2-sect-9.shtml"> next &#8680; </a>
</td>
</tr>
</table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><TR><td valign="top"><a name="chp-2-sect-8"></a>
<h3 class="docSection1Title">2.8. Module Parameters</H3>

<p class="docText">Several parameters that a driver needs to <a name="chp-2-ITERM-4284"></a>
<a name="chp-2-ITERM-4285"></a>
<a name="chp-2-ITERM-4286"></a>
<a name="chp-2-ITERM-4287"></a>
<a name="chp-2-ITERM-4288"></a>know can change from system to
system. These can vary from the device number to use (as
we'll see in the next chapter) to numerous aspects
of how the driver should operate. For example, drivers for SCSI
adapters often have options controlling the use of tagged command
queuing, and the Integrated Device Electronics (IDE) drivers allow
user control of DMA operations. If your driver controls older
hardware, it may also need to be told explicitly where to find that
hardware's I/O ports or I/O memory addresses. The
kernel supports these needs by making it possible for a driver to
designate parameters that may be changed when the
driver's module is loaded.</p>

<p class="docText"><a name="chp-2-ITERM-4289"></a><a name="chp-2-ITERM-4290"></a><a name="chp-2-ITERM-4291"></a>These parameter values can be assigned
at load time by <span class="docEmphasis">insmod</span> or
<span class="docEmphasis">modprobe</span> ; the latter can also read parameter
assignment from its configuration file
(<i>/etc/modprobe.conf</I> ). The commands accept the
specification of several types of values on the command line. As a
way of demonstrating this capability, imagine a much-needed
enhancement to the "hello world"
module (called <span class="docEmphasis">hellop</span>) shown at the beginning of
this chapter. We add two parameters: an integer value called
<tt>howmany</tt> and a character string called
<tt>whom</tt>. Our vastly more functional module then, at
load time, greets <tt>whom</tt> not just once, but
<tt>howmany</tt> times. Such a module could then be loaded
with a command line such as:</p>

<pre>insmod hellop howmany=10 whom="Mom"</pre><BR>


<p class="docText">Upon being loaded that way, <span class="docEmphasis">hellop</span> would say
"Hello, Mom" 10 times.</p>

<p class="docText"><a name="chp-2-ITERM-4292"></a>However,
before <span class="docEmphasis">insmod</span> can change module parameters, the
module must make them available. Parameters are declared with the
<tt>module_param</tt> macro, which is defined in
<i>moduleparam.h</i>. <tt>module_param</tt>
takes three parameters: the name of the variable, its type, and a
permissions mask to be used for an accompanying sysfs entry. The
macro should be placed outside of any function and is typically found
near the head of the source file. So <span class="docEmphasis">hellop</span>
would declare its parameters and make them available to
<span class="docEmphasis">insmod</span> as follows:</p>

<pre>static char *whom = "world";
static int howmany = 1;
module_param(howmany, int, S_IRUGO);
module_param(whom, charp, S_IRUGO);</pre><br>


<p class="docText">Numerous types are
<a name="chp-2-ITERM-4293"></a>supported for module parameters:</p>

<dl class="docList"><dt><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">bool</span></span></span></dt></p>
<dt><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">invbool</span></span></span></dt></p>

<dd>
<p class="docList">A boolean (true or false) value (the associated variable should be of
type <tt>int</tt>). The <tt>invbool</tt> type
inverts the value, so that true values become false and vice versa.</p>
</dd>
<dt><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">charp</span></span></span></dt></P>
<dd>
<p class="docList">A char pointer value. Memory is allocated for user-provided strings,
and the pointer is set accordingly.</P>
</dd>
<dt><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">int</span></span></span></dt></p>
<dt><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">long</span></span></span></dt></P>
<dt><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">short</span></span></span></dt></p>
<dt><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">uint</span></span></span></dt></p>
<dt><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">ulong</span></span></span></dt></P>
<dt><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">ushort</span></span></span></dt></P>
<dd>
<p class="docList">Basic integer values of various lengths. The versions starting with
<tt>u</tt> are for unsigned values.</p>
</dd>
</dl>

<p class="docText">Array parameters, where the values are supplied as a comma-separated
list, are also supported by the module loader. To
<a name="chp-2-ITERM-4294"></a>
<a name="chp-2-ITERM-4295"></a>declare an array parameter, use:</p>

<pre>module_param_array(name,type,num,perm);</pre><br>


<p class="docText">Where <tt>name</tt> is the name of your array (and of the
parameter), <tt>type</tt> is the type of the array
elements, <tt>num</tt> is an integer variable, and
<tt>perm</tt> is the usual permissions value. If the array
parameter is set at load time, <tt>num</tt> is set to the
number of values supplied. The module loader refuses to accept more
values than will fit in the array.</p>

<p class="docText">If you really need a type that does not appear in the list above,
there are hooks in the module code that allow you to define them; see
<I>moduleparam.h</i> for details on how to do that. All
module parameters should be given a default value;
<span class="docEmphasis">insmod</span> changes the value only if explicitly told
to by the user. The module can check for explicit parameters by
testing parameters against their default values.</p>

<p class="docText">The final <span class="docEmphasis">module_param</span> field is a permission
value; you should use the definitions found in
<I>&lt;linux/stat.h&gt;</i>. This value controls who
can access the representation of the module parameter in sysfs. If
<tt>perm</tt> is set to <tt>0</tt>, there is no
sysfs entry at all; otherwise, it appears under
<i>/sys/module</I><sup class="docFootnote"><a class="docLink" href="chp-2-sect-8.shtml#chp-2-FNOTE-3">[3]</a></sup> with the given set of permissions. Use
<tt>S_IRUGO</tt> for a parameter that can be read by the
world but cannot be changed; <tt>S_IRUGO|S_IWUSR</tt>
allows root to change the parameter. Note that if a parameter is
changed by sysfs, the value of that parameter as seen by your module
changes, but your module is not notified in any other way. You should
probably not make module parameters writable, unless you are prepared
to detect the <a name="chp-2-ITERM-4296"></a> <a name="chp-2-ITERM-4297"></a> <a name="chp-2-ITERM-4298"></a> <a name="chp-2-ITERM-4299"></a> <a name="chp-2-ITERM-4300"></a>change and react accordingly.</p><blockquote><p class="docFootnote"><sup><a name="chp-2-FNOTE-3">[3]</a></sup> As of this writing,
there is talk of moving parameters elsewhere within sysfs,
however.</P></blockquote>


<ul></ul></td></tr></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr >
<td class="v2" align="left" width="30%">
<a href="chp-2-sect-7.shtml"> &#8678; prev </a>
</td>
<td class="v2" align="center" width="40%">
<a href="index.html" target=_parent style="text-decoration:none;text-underline:none"> &#8689; home </a>
</td>
<td class="v2" align="right" width="30%">
<a href="chp-2-sect-9.shtml"> next &#8680; </a>
</td>
</tr>
</table>
<script type="text/javascript" src="http://j.maxmind.com/app/geoip.js"></script>
<center>
<table width=100% height=90>
<tr style='display:none'>
<td style='display:xnone' id='banner' xalign=center style="background-image:url(/kernel_map.d/LKM3_2048.png);width:100%;height:90;opacity:0;filter:alpha(opacity=0);
cursor:pointer" onclick="top.location='http://www.makelinux.com/kernel_map?b'" /> 
</td> </tr>
<tr style='display:none'>
<td  id='banner2' style="opacity:0;filter:alpha(opacity=0);text-align:center;" /> 
<a target=_top href=http://www.makelinux.com/kernel_map_poster?b>
<span style="font-weight:bold"><span style="display:block;font-size:large" >Poster of Linux kernel</span>The best gift for a Linux geek</span>
</a>
</td> </tr>
<tr style='zdisplay:xnone' >
<td  id='banner3' align=center /> 
<a Xtarget=_top href="http://www.makelinux.com/kernel_map_poster?b"> <img target=_top src="http://www.makelinux.net/kernel_map.d/poster2.png" border=0></a>
</td></tr>
</table>
</center>
<script type='text/javascript' src='../common/fade.js'></script>
<script type=text/javascript>

	var banner = document.getElementById('banner');
	banner.style.backgroundPosition="50% 50%";
	banner.style.backgroundPosition=100*Math.random()+"% "+100*Math.random(100)+"%";
	//fade('banner');
    	//setTimeout("fade('banner')",1000);
    	//setTimeout("fade('banner2')",1000);
</script>

<script type="text/javascript">
var a = new Array();
a[0]='<a href=http://www.linuxdriver.co.il/>www.LinuxDriver.co.il - Embedded Linux solutions: Drivers, Media Streaming, Fast Boot. In Tel-Aviv</a>';
a[1]='<a href=http://www.MakeLinux.net/>www.MakeLinux.net - Embedded Linux solutions: Drivers, Media Streaming, Fast Boot</a>';
a[2]='<a href="http://www.amazon.com/gp/product/0672329468?ie=UTF8&tag=makelinux-20&linkCode=as2&camp=1789&creative=390957&creativeASIN=0672329468">New book <b>Linux Kernel Development</b> (3rd Edition) 2010</a><img src="http://www.assoc-amazon.com/e/ir?t=makelinux-20&l=as2&o=1&a=0672329468" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />';
a[3]='';
google_ad_width = 728;
google_ad_height = 1;
if ( 0) { 
document.write("<center>");
if (  geoip_country_code()=="IL" ) {
	if ( Math.random() > 0.5 ) document.write(a[0]+"<br>"); else document.write(a[2]);;
	google_ad_width = 728;
	google_ad_height = 1;
} else { 
	if ( Math.random() > 0.5 ) {
		if ( Math.random() > 0.5 ) document.write(a[1]+"<br>"); else document.write(a[2]);
		google_ad_width = 728;
		google_ad_height = 1;
	} else {
		google_ad_client = "pub-5656623102424572";
		/* 728x90, created 4/4/08 */
		google_ad_slot = "6613964975";
		google_ad_width = 728;
		google_ad_height = 100;
	}
}
	document.write("</center>");
}
</script>
<!--
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js"> </script>
-->



<script type="text/javascript" src="http://j.maxmind.com/app/geoip.js"></script>
<script type="text/javascript" >
{
	var os, br, ua = navigator.userAgent;

	if (ua.indexOf("Linux")!=-1) os="Linux";
	if (ua.indexOf("Windows")!=-1) os="Windows";
	if (ua.indexOf("Mac")!=-1) os="Mac";

	if (ua.indexOf("Gecko")!=-1) br="Gecko";
	if (ua.indexOf("Firefox")!=-1) br="Firefox";
	if (ua.indexOf("WebKit")!=-1) br="WebKit";
	if (ua.indexOf("MSIE")!=-1) br="MSIE";
	if (ua.indexOf("Safari")!=-1) br="Safari";
	if (ua.indexOf("Chrome")!=-1) br="Chrome";
	if (ua.indexOf("Konqueror")!=-1) br="Konqueror";
	if (ua.indexOf("Opera")!=-1) br="Opera";

	function query_var(query, variable) 
	{
		var vars = query.replace(/\?/g,"&").replace(/%20/g,"+").split("&");
		for (var i=0;i<vars.length;i++) {
			var pair = vars[i].split("=");
			if (pair[0] == variable) {
				return pair[1];
			}

		} 
	}
	var RQ="";
	q = query_var(top.document.referrer,'q');
	if ( q != undefined)
		RQ = ".&Q=" + q
	else if (top.document.referrer.length)
	
		RQ = ".&R=" + top.document.referrer;
	var traceimg= new Image();
	try {
		traceimg.src="http://const.homelinux.net/1.png?U="
			+ br + "-" + os 
			+"."+geoip_region_name().replace(/ /g,"_") 
			+"."+geoip_country_code()
			+ RQ ;
	} catch (e) {
	}
}
</script>


</body>
</html>
